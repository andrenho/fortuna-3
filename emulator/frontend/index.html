<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=yes, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Fortuna-3 emulator</title>

    <script src="components/common.js"></script>
    <script src="components/flat-data.js"></script>

</head>

<!---- CSS - STYLE ---->
<style>
    @font-face { font-family: ShareTech; src: url('/data/ShareTechMono-Regular.ttf'); }

    .error { color: red; }
</style>

<!---- HTML - BODY ---->
<body>

    <h1 class="error" id="error">
        <!-- any errors will be shown here -->
    </h1>

    <flat-data id="ram" title="Memory (RAM)" current-page="0" page-count="256" rows="16" highlight-address="2">
    </flat-data>

    <script>

        const ram = new Uint8Array(64 * 1024);
        window.crypto.getRandomValues(ram);

        const highlightAddr = 258;

        // on page change
        document.getElementById("ram").addEventListener("page-change", (e) => {
            const { addrStart, addrEnd, page } = e.detail;
            e.target.setAttribute("current-page", page);
            e.target.setAttribute("data", ram.slice(addrStart, addrEnd).toString());
            e.target.setAttribute("highlight-address", (highlightAddr > addrStart && highlightAddr <= addrEnd) ? highlightAddr % 256 : undefined);
        });

        // on data change
        const { addrStart, addrEnd } = document.getElementById("ram").addressRange();
        document.getElementById("ram").setAttribute("data", ram.slice(addrStart, addrEnd).toString());

    </script>

</body>

</html>

<!-- vim: foldmethod=indent:ts=4:sts=4:sw=4:noexpandtab
-->
